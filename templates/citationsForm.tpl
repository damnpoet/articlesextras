{** * citationsForm.tpl * * Copyright (c) 2009-2013 Richard González Alberto * Distributed under the GNU GPL v2. For full terms see the file docs/COPYING. * * Submit Citation Form * *}{assign var="pageTitle" value="plugins.generic.articlesExtras.editCitations"}{include file="common/header.tpl"}<br /><ul class="nav nav-pills">	<li><a href="{url page="ArticlesExtrasPlugin" op="submitAuthorAdditionalFields" path=$article->getId()}">{translate key="plugins.generic.articlesExtras.authors"}</a></li>	<li><a href="{url page="ArticlesExtrasPlugin" op="submitBody" path=$article->getId()}">Cuerpo</a></li>	<li><a href="{url page="ArticlesExtrasPlugin" op="submitImages" path=$article->getId()}">Imagenes</a></li>	<li class="active"><a href="{url page="ArticlesExtrasPlugin" op="submitCitations" path=$article->getId()}">Citas</a></li></ul><p>Modificando citas para el artículo: <strong>{$article->getArticleTitle()}</strong><p><a id="btnCrearCita" href="#myModal" role="button" class="btn" data-toggle="modal">Crear Cita</a><a id="btnReloadCitas" class="btn">Recargar Citas</a><!-- Modal --><div class="modal hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">    <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>        <h3 id="myModalLabel">{translate key="plugins.generic.articlesExtras.form.newcitation"}</h3>    </div>    <div class="modal-body">        <form id="frmCitationPart" name="frmCitationPart" class="form-horizontal">                <p><strong>Paso 1</strong>: Seleccione el siguiente campo para definir el idioma de la cita.</p>                <div class="control-group">                    <label class="control-label" for="selectLanguage">{translate key="plugins.generic.articlesExtras.citations.language"}</label>                    <div class="controls">                        <select id="selectLanguage" name="selectLanguage">                            <option value="" selected="selected"></option>                            {foreach from=$locales item=locale}                            <option value="{$locale}" {if $locale == $currentLocale}selected="selected"{/if}>{$locale}</option>                            {/foreach}                        </select>                    </div>                </div>                <p><strong>Paso 2</strong>: Partes de la cita.</p>                <div class="control-group">                    <label class="control-label" for="selectCitationPart">Parte</label>                    <div class="controls">                        <select id="selectCitationPart">                            <option id="authors" value="authors">{translate key="plugins.generic.articlesExtras.citations.authors"}</option>                            <option id="bookChapter" value="bookChapter">{translate key="plugins.generic.articlesExtras.citations.bookchapter"}</option>                            <option id="confArticle" value="confArticle">{translate key="plugins.generic.articlesExtras.citations.confArticle"}</option>                            <option id="author_organization" value="author_organization">{translate key="plugins.generic.articlesExtras.citations.orgAuthors"}</option>                            <option id="editors" value="editors">{translate key="plugins.generic.articlesExtras.citations.editors"}</option>                            <option id="title" value="title">{translate key="plugins.generic.articlesExtras.citations.title"}</option>                            <option id="typeTitle" value="typeTitle">{translate key="plugins.generic.articlesExtras.citations.typetitle"}</option>                            <option id="conference" value="conference">{translate key="plugins.generic.articlesExtras.citations.conference"}</option>                            <option id="edition" value="edition">{translate key="plugins.generic.articlesExtras.citations.edition"}</option>                            <option id="pubPlace" value="pubPlace">{translate key="plugins.generic.articlesExtras.citations.pubPlace"}</option>                            <option id="state" value="state">{translate key="plugins.generic.articlesExtras.citations.state"}</option>                            <option id="editorial" value="editorial">{translate key="plugins.generic.articlesExtras.citations.editorial"}</option>                            <option id="source" value="source">{translate key="plugins.generic.articlesExtras.citations.source"}</option>                            <option id="typeSource" value="typeSource">{translate key="plugins.generic.articlesExtras.citations.typesource"}</option>                            <option id="date" value="date">{translate key="plugins.generic.articlesExtras.citations.date"}</option>                            <option id="siteDate" value="siteDate">{translate key="plugins.generic.articlesExtras.citations.dateweb"}</option>                            <option id="updDate" value="updDate">{translate key="plugins.generic.articlesExtras.citations.upddate"}</option>                            <option id="citDate" value="citDate">{translate key="plugins.generic.articlesExtras.citations.citdate"}</option>                            <option id="volume" value="volume">{translate key="plugins.generic.articlesExtras.citations.volume"}</option>                            <option id="suppl_volume" value="suppl_volume">{translate key="plugins.generic.articlesExtras.citations.supplvolume"}</option>                            <option id="part_volume" value="part_volume">{translate key="plugins.generic.articlesExtras.citations.partvolume"}</option>                            <option id="issue" value="issue">{translate key="plugins.generic.articlesExtras.citations.issue"}</option>                            <option id="suppl_issue" value="suppl_issue">{translate key="plugins.generic.articlesExtras.citations.supplissue"}</option>                            <option id="part_issue" value="part_issue">{translate key="plugins.generic.articlesExtras.citations.partissue"}</option>                            <option id="sitePage" value="sitePage">{translate key="plugins.generic.articlesExtras.citations.pagewebsite"}</option>                            <option id="pageTitleWeb" value="pageTitleWeb">{translate key="plugins.generic.articlesExtras.citations.pageTitleWeb"}</option>                            <option id="pages" value="pages">{translate key="plugins.generic.articlesExtras.citations.pages"}</option>                            <option id="pageCount" value="pageCount">{translate key="plugins.generic.articlesExtras.citations.pagecount"}</option>                            <option id="retraction_contains" value="retraction_contains">{translate key="plugins.generic.articlesExtras.citations.retractionof"}</option>                            <option id="retraction_object_of" value="retraction_object_of">{translate key="plugins.generic.articlesExtras.citations.retractionin"}</option>                            <option id="correction" value="correction">{translate key="plugins.generic.articlesExtras.citations.correction"}</option>                            <option id="erratum" value="erratum">{translate key="plugins.generic.articlesExtras.citations.erratum"}</option>                            <option id="epub" value="epub">{translate key="plugins.generic.articlesExtras.citations.epub"}</option>                            <option id="forthcoming" value="forthcoming">{translate key="plugins.generic.articlesExtras.citations.forthcoming"}</option>                            <option id="section" value="section">{translate key="plugins.generic.articlesExtras.citations.section"}</option>                            <option id="column" value="column">{translate key="plugins.generic.articlesExtras.citations.col"}</option>                            <option id="url" value="url">{translate key="plugins.generic.articlesExtras.citations.url"}</option>                        </select>                                                <button id="btnAddCitationPart" class="btn">{translate key="plugins.generic.articlesExtras.citations.add"}</button>                    </div>                </div>                                <div class="control-group">                    <label class="control-label" for="selectCitationPart">Plantilla</label>                    <div class="controls">                        <select id="citationTemplate">                            <option disabled="disabled">Articulos en Revistas</option>                            <option value="art-norm">Art&iacute;culo de revista normal</option>                            <option value="org-as-author">Organizacion como autor</option>		                              <option value="author-org-as-author">Autores personales + Organizacion como autor</option>                            <option value="no-author">No aparece el autor</option>                            <option value="vol-suppl">Volumen con Suplemento</option>                            <option value="issue-suppl">Numero con Suplemento</option>                            <option value="vol-part">Volumen con parte</option>                            <option value="issue-part">Numero con parte</option>                            <option value="issue-no-vol">Numero sin volumen</option>                            <option value="no-issue-no-vol">No aparece volumen ni numero</option>                            <option value="title-with-type">Con tipo en el titulo</option>                            <option value="with-retraction">Con retractacion</option>                            <option value="with-parcial-retraction">Con retractacion parcial</option>                            <option disabled="disabled" style="margin-top: 1em;">Libros y otras monografias</option>                            <option value="author-personal">Autores Personales</option>                            <option value="editor-compilator-as-author">Editor(es), Compilador(es) como autor</option>                            <option value="author-editor">Autor(es) y Editor(es)</option>                            <option value="book-org-as-author">Organizacion como autor</option>                            <option value="book-chapter">Capitulo en un libro</option>                            <option value="dissertation">Tesis</option>                            <option disabled="disabled" style="margin-top: 1em;">Otro material publicado</option>                            <option value="art-newspapper">Articulo de periodico</option>                            <option value="audiovisual">Material audiovisual</option>                            <option disabled="disabled" style="margin-top: 1em;">Material electronico</option>                            <option value="cdrom">CD-ROM</option>                            <option value="art-internet">Articulo de revista en internet</option>                            <option value="monog-internet">Monografia en internet</option>                            <option value="homepage">Pagina principal/sitio web</option>                            <option value="homepage-part">Parte de una pagina principal/sitio web</option>                        </select>                                                <button type="button" id="btnApplyTemplate" class="btn">Aplicar</button>                    </div>                </div>                        </form>                <hr />                <form id="frmCitation" class="form-horizontal">                <div id="citations-parts-container"></div>        </form>                <div id="citation-preview-container"></div>                <div style="clear: both;"></div>    </div>    <div class="modal-footer">        <button id="btnFormCrearCita" class="btn" data-dismiss="modal" aria-hidden="true">Cerrar</button>        <button id="btnFormPrevisualizar" class="btn">Previsualizar</button>        <button id="btnFormLimpiar" class="btn">Limpiar formulario</button>        <button id="btnFormReloadCitas" class="btn btn-primary">Crear nueva cita</button>    </div></div><br /><div id="citations-container"></div><div id="debugArea"></div><script type="text/javascript">var baseUrl = "{$baseUrl}";var url = "{url page="ArticlesExtrasPlugin" op="getCitationsTable" path=$article->getId()}";var urlUpdateOjsArticleCitations = "{url page="ArticlesExtrasPlugin" op="updateOjsArticleCitations" path=$article->getId()}";var urlDelete = "{url page="ArticlesExtrasPlugin" op="deleteCitation" path=$article->getId()}";var urlMove = "{url page="ArticlesExtrasPlugin" op="moveCitations" path=$article->getId()}";var urlInsertPart = "{url page="ArticlesExtrasPlugin" op="insertCitationPart"}";var urlApplyTpl = "{url page="ArticlesExtrasPlugin" op="applyCitationTemplate"}";var urlPreview = "{url page="ArticlesExtrasPlugin" op="citationPreview"}";var urlAddCite = "{url page="ArticlesExtrasPlugin" op="insertCitation" path=$article->getId()}";var urlGetCite = "{url page="ArticlesExtrasPlugin" op="getCitation" path=$article->getId()}";{literal}/*<![CDATA[*/function reloadCitations(){	$.post(urlUpdateOjsArticleCitations, function(data) {});	$('#citations-container').html('<center><img alt="Cargando..." src="'+baseUrl+'/images/loading.gif" /> &nbsp; Cargando Citas...</center>');	$.getJSON(url, function(jsonData) {		$('#citations-container').html(jsonData.content);		$('.namesTips').tooltip();                // TODO: add table handler!	});}// true if exist a empty value in formfunction areEmptyValues(langujeData, formData){		formData = formData.split("&")	var empty = false	if (langujeData == ""){		empty = true	}else{		for (var i = formData.length - 1; i >= 0; i--) {			var part = formData[i].split("=")			if (part[1]){						}else{				if (part[0] != "day" && part[0] != "citDay" && part[0] != "page_final" && part[0] != "siteDateTo"){					empty = true				}			}		};	}	return empty}// replace extrain chars from citation form datafunction replaceExtrainChars(formData){	formData = formData.replace("'", "’");	return formData;    }reloadCitations(); // initial load$('#btnCrearCita').live('click', function(){	$('#citations-parts-container').html('');	$('#citation-preview-container').html('');});$('#btnReloadCitas').live('click', function(){	reloadCitations();});$('.btnDeleteCitation').live('click', function(){	if(confirm("Estas seguro de que deseas eliminar esta cita? Al eliminar esta cita no podras recuperarla...")){		var id = $(this).attr('id');		$.get(urlDelete + '/' + id, null, function(){			reloadCitations();					});			}	return false;});$('.btnEditCitation').live('click', function(){	$.getJSON(urlGetCite + '/' +  $(this).attr('id'), function(jsonData) {            $('#selectLanguage').val(jsonData.lang);            $('#citations-parts-container').html(jsonData.citationForm);            $('#citation-preview-container').html('');                        $('#myModal').modal('show');	});	return false;});$('#btnAddCitationPart').live('click', function(){	$.getJSON(urlInsertPart + '/' + $('#selectCitationPart').val(), function(jsonData) {		$('#citations-parts-container').append(jsonData.content);	});});$('#btnApplyTemplate').live('click', function(){	$.getJSON(urlApplyTpl + '/' + $('#citationTemplate').val(), function(jsonData) {		$('#citations-parts-container').html(jsonData.content);	});});/* FORM ACTIONS */$('#btnFormCrearCita').live('click', function(){        var citationForm = replaceExtrainChars($('#frmCitation').serialize());        var isEmpty = areEmptyValues($('#selectLanguage').val(), citationForm);        if (isEmpty == true){                alert("Existen campos vacios o incorrectos.")        } else {                $.post(urlAddCite, citationForm + "&lang=" + $('#selectLanguage').val(), function(data) {                        reloadCitations();                        $('#citations-parts-container').html('');                        $('#citation-preview-container').html('');                        if(confirm("Cita creada correctamente. Deseas crear otra?")) {                                $('#myModal').modal('show');                        }                });                $('#myModal').modal('hide');        }});$('#btnFormLimpiar').live('click', function(){        if(confirm("Estas seguro que deseas limpiar el formulario actual? Tenga en cuanto que esto eliminara todas las partes insertadas asi que como los datos que contienen. Aun asi deseas proceder?")){                $('#citations-parts-container').html('');                $('#citation-preview-container').html('');        }});$('#btnFormPrevisualizar').live('click', function(){        var citationForm = replaceExtrainChars($('#frmCitation').serialize());        var isEmpty = areEmptyValues($('#selectLanguage').val(), citationForm);        if (isEmpty == true){                $('#citation-preview-container').html('<center><img alt="Error:" src="'+baseUrl+'/images/error.gif" /> &nbsp; <font color="red">Existen campos vacios o incorrectos.</font></center>');        } else {                $('#citation-preview-container').html('<center><img alt="Cargando..." src="'+baseUrl+'/images/loading.gif" /> &nbsp; Cargando Previsualizacion...</center>');                $.post(urlPreview, citationForm + "&lang=" + $('#selectLanguage').val(), function(data) {                        $('#citation-preview-container').html("<label>Previsualizacion:</label><br /><br />" + data);                        $('.namesTips').tipsy();                });        }});/*]]>*/{/literal}</script>{include file="common/footer.tpl"}